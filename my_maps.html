<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">

 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
	integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
	crossorigin=""/>

 <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
 <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css"/>
 <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css"/>
 <link rel="stylesheet" href="bootstrap/dist/css/bootstrap.min.css" />
 <link rel="stylesheet" href="style/css/app.css" />
 <link rel="stylesheet" href="style/css/mymaps.css" />
 <title>My maps</title>
</head>
<body>

<header>

 <div class="container-fluid">
  <nav id="menu" class="navbar navbar-light">
   <div style="display: inline">
       <img src="style/img/logo.png" id="logo" />
    <h4 style="display: inline" id="app-name">Events Location</h4>
   </div>
   
		
	<div class="input-group-prepend">
	<input type="text" class="form-control" placeholder="Look for a map...">
		<div class="input-group-append">
		<button type="button" class="btn btn-outline-secondary"><i class="fa fa-search"></i></button>    
		</div>
	</div>
	<ul class="nav ">
    <li class="nav-item">
     <a class="nav-link" href="index.html">Home</a>
    </li>
    <li class="nav-item">
     <a class="nav-link " href="public.html">Public area</a>
    </li>
    <li class="nav-item">
     <a class="nav-link active" href="my_maps.html">My maps</a>
    </li>

    <li class="nav-item dropdown auth">
        <a class=" nav-link dropdown-toggle" data-toggle="dropdown" href="#"
           aria-haspopup="true" aria-expanded="false">@pseudo</a>
        <div class="dropdown-menu dropdown-menu-right">
            <a class="dropdown-item" href="#"  data-toggle="modal" data-target="#changePassword" >Change password</a>
            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#" id="logoutBtn">Logout</a>
        </div>
    </li>


   </ul>
  </nav>
 </div>
</header>

<div class="container-fluid" id="containerWelcome">
	<h3>Bienvenue sur votre espace de création de cartes personnelles !</h3>
	<h3>Créez votre première carte :</h3>
	<button type="button"
            class="firstMapBtn" data-toggle="modal" data-target="#newMapModal" >
        <i class="fas fa-plus-circle"></i></button>

</div>


<div  id="containerMaps">
	<div id="mapid"></div>
	<div id="markplace">	
	</div>
	
  <div class="row">

      <button type="button"
              class="firstMapBtn" id="createMap" data-toggle="modal" data-target="#newMapModal" >
          <i class="fas fa-plus-circle"></i></button>

	<div  id="result" class="slidemaps slider slider-nav">

	</div>
  </div>
</div>

<div class="modal fade" role="dialog" id="photosModal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Photos manager</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" id="modalBodyPic">
		<a href='#'> 
			<img src="style/img/add-camera.png" id="addPhotoBtn">
		</a>
	  </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary">Save changes</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" role="dialog" id="newMapModal">
  <div class="modal-dialog" role="document">
  
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Create new map</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
		
		<form id="form-newMap" action='#'>	  
			<div class="modal-body" >
				<div class="row justify-content-center">
					<div class="col-sm-10">
						<div class="alert alert-danger error" role="alert" style="display: none; height:35px; padding: 5px"></div>
						<input class="form-control" type="text" placeholder="Name of the map" name="name" id="idNameMap"> </br>
					</div>
					<div class="col-sm-10">
						<textarea class="form-control" placeholder="Description" name="desc" id="idDescMap"></textarea>
					</div>
				</div>		
			</div>



			
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary" id="createMapBtn">Create</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
	  
		</form>
	  
    </div>
  </div>
</div>


<script type="text/template" id="tmpl-message">
    <% _(maps).each(function(map) { %>

        <div class="card event-map">
            <div class="card-body">

                <h5 class="card-title" style="font-weight: bold">
                    <a href="#" class="map-link"><%= map.name %> <span hidden><%= map.id %></span></a></h5>
                <p class="card-text"><%= map.description %></p>
                <p>Tag :
                    <% _(map.tags).each(function(tag) { %>
                        <a href="#" class="badge badge-tag"><%= tag %></a>
                    <% }) %>
                </p>
            </div>
        </div>

    <% }) %>
</script>

<div class="modal fade" role="dialog" id="changePassword">
    <div class="modal-dialog" role="document">

        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Change your password</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <form id="updatePassword" action='#'>
                <div class="modal-body" >
                    <div class="row justify-content-center">
                        <div class="col-sm-12">
                            <div class="alert alert-danger error" role="alert" style="display: none; height:35px; padding: 5px"></div>
                            <input class="form-control" type="password" placeholder="Actual password" name="password" > </br>
                        </div>
                    </div>
                    <div class="row justify-content-center">
                        <div class="col-sm-12">
                            <input class="form-control" type="password"
                                   placeholder="New password" name="password" > </br>
                        </div>
                    </div>
                    <div class="row justify-content-center">
                        <div class="col-sm-12">
                            <input class="form-control" type="password"
                                   placeholder="Confirm new password" name="password" > </br>
                        </div>
                    </div>
                </div>


                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">update</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>

            </form>

        </div>
    </div>
</div>

<footer id="footer">
 <div class="row">
  <div class="col-sm-12">

   <h6 id="copyright">copyright © 2018 - GL</h6>
  </div>
 </div>
</footer>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script  src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>
<script src="bootstrap/dist/js/bootstrap.min.js"></script>
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"/>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>
<script src="script/app.js"></script>

<script type="text/javascript">



</script>
<script>
    var map = L.map('mapid').setView([48.85, 2.35], 13);
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map);

    /*L.marker([48.841, 2.355]).addTo(map)
        .bindPopup('Place X')
        .openPopup();*/

    function createButton(label, container) {
        var btn = L.DomUtil.create('button', 'addedbtn', container);
        btn.setAttribute('type', 'button');
        btn.innerHTML = label;
        return btn;
    }

    function addImage(fileInput, container) {
        if (fileInput.files.length >0) {
            var file = fileInput.files[0];
            var reader  = new FileReader();
            reader.onload = function(e)  {
                var image = document.createElement("img");
                image.src = e.target.result;
                image.style.maxWidth = '300px'
                image.style.maxHeight = '300px'

                container.appendChild(image);
            }
            reader.readAsDataURL(file);
        }

    }

    map.on('click', function(e) {
        var container = L.DomUtil.create('div'),
            contMark = L.DomUtil.create('div'),
            markBtn = createButton('Mark place', contMark);
        contMark.className = "markContainer";
        container.appendChild(contMark);

        var contLoc = L.DomUtil.create('div'),
            startBtn = createButton('Start from this location', contLoc),
            destBtn = createButton('Go to this location', contLoc);
        container.appendChild(contLoc);

        <!-- L.DomEvent.on(startBtn, 'click', function() { -->
        <!-- control.spliceWaypoints(0, 1, e.latlng); -->
        <!-- map.closePopup(); -->
        <!-- }); -->

        <!-- L.DomEvent.on(destBtn, 'click', function() { -->
        <!-- control.spliceWaypoints(control.getWaypoints().length - 1, 1, e.latlng); -->
        <!-- map.closePopup(); -->
        <!-- }); -->

        L.DomEvent.on(markBtn, 'click', function() {
            var contName = document.createElement("div");
            var labelName = L.DomUtil.create("label",'labelTitle',contName);
            labelName.innerHTML = "Place name";
            var inputName = document.createElement("input");
            inputName.type = "text";
            contName.appendChild(inputName);
            container.appendChild(contName);

            var contMsg = document.createElement("div");
            var label = L.DomUtil.create("label",'labelTitle',contMsg);
            label.innerHTML = "Message";
            var inputMsg = document.createElement("textarea");
            inputMsg.rows = "4";
            inputMsg.maxLength = "160";
            inputMsg.cols = "35";
            contMsg.appendChild(inputMsg);
            container.appendChild(contMsg);

            var contPict = document.createElement("div");
            label = document.createElement("label");
            label.innerHTML = "Pictures";
            contPict.appendChild(label);
            var pic = document.createElement("input");
            pic.type = "file";
            contPict.appendChild(pic);
            container.appendChild(contPict);

            $('#addPhotoBtn').click(function(){
                var fileInput = document.createElement("input");
                fileInput.type = "file";

                $(fileInput).trigger('click');
                $(fileInput).change(function(){
                    addImage(fileInput, document.querySelector("#modalBodyPic"));
                })
            });

            var contValid = L.DomUtil.create('div'),
                okBtn = createButton('Validate', contValid);
            contValid.className = "markContainer";
            container.appendChild(contValid);

            L.DomEvent.on(okBtn, 'click', function() {
                addImage(pic, document.querySelector("#modalBodyPic"));
                if (inputName.value != "") {
                    var newPopup = L.DomUtil.create('div');
                    var n = L.DomUtil.create('div');
                    n.style.textAlign = "center";
                    var titlePop = L.DomUtil.create('label', '', n);
                    titlePop.innerHTML = "<b>"+inputName.value+"</b>";
                    newPopup.appendChild(n);
                    if (inputMsg.value != ""){
                        var m = L.DomUtil.create('div');
                        var msgPop = L.DomUtil.create('label', '', m);
                        msgPop.innerHTML = inputMsg.value+"<br />";
                        newPopup.appendChild(m);
                    }
                    var seePicsBtn = L.DomUtil.create('button','',newPopup);
                    seePicsBtn.innerHTML = "See photos";
                    seePicsBtn.setAttribute("data-toggle", "modal");
                    seePicsBtn.setAttribute("data-target", "#photosModal");

                    var p = L.popup()
                        .setContent(newPopup)
                        .setLatLng(e.latlng);

                    L.marker(e.latlng).addTo(map)
                        .bindPopup(p)
                        .openPopup();

                }
                else {
                    labelName.style.color = "red";
                    labelName.innerHTML = "Place name (essential)"
                }
            });

            markBtn.style.display = 'none';
        });

        L.popup()
            .setContent(container)
            .setLatLng(e.latlng)
            .openOn(map);

    });
    <!-- L.Routing.control({ -->
    <!-- waypoints: [ -->
    <!-- L.latLng(48.74, 2.40), -->
    <!-- L.latLng(48.1, 2.36) -->
    <!-- ] -->
    <!-- }).addTo(map); -->


</script>
<script src="script/my_maps.js"></script>
</body>
</html>